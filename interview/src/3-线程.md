> ## 线程

### 如果一个线程构造了一个不可变对象, 就可以保证这个对象被其它程序正确查看吗? 
不能，这个不可变对象需要初始化完成。需要考虑this逃逸现象

### 线程调用过程?
线程调用start()之后使得线程进入资源竞争状态，当线程获取时间片后调用线程的run()方法

### 守护线程和用户线程区别?
守护线程也就是后台线程，不会阻止用户线程的结束。用户线程结束，守护线程也跟着结束。

### 你对线程优先级的理解?
线程优先级也就是公平锁和非公平锁的实现，线程优先级高的线程不一定能够比优先级低的线程先抢夺到资源。

### 同步方法和同步块哪种方式好?
同步块更好，粒度更小

### 线程有哪些状态? 画一下线程状态转移图
线程状态：创建，可运行，运行，阻塞(等待阻塞(wait)与一般阻塞(sleep, System.in))，结束

### 数据库连接池与线程池?
数据库连接池：在系统启动时创建一组线程组成线程池，在有请求时，从线程池中获得线程去处理，处理完之后放回线程池中。如果请求过多，线程池中没有线程，则会阻塞线程。

### 为什么使用线程池, 为什么使用数据库连接池?
优点：方便线程管理；降低并发；降低线程和对象频繁创建和销毁的性能开销

### 线程池ThreadPoolExecutor有哪些参数? 
int corePoolSize;	// 线程池大小
int maxmumPoolSize;	// 线程池中允许的最大线程数
long keepAliveTime;	// 当线程数大于核心线程数，终于多余空闲的线程等待新任务的最长时间
TimeUnit unit;	// keepAliveTime的单位
BlockingQueue<Runnable> workQueue;	// 储存还没有来得及执行的任务的队列
ThreadFactory threadFactory;
RejectedExecutionHandler handler;	// 线程超过容量时的处理方法

### 线程池中线程任务数超过核心数会发生什么? 阻塞队列大小? 
线程中任务数超过核心数后会被阻塞放到阻塞队列中。
阻塞队列大小受阻塞队列本身影响。

### 线程池的组成?
1. 线程池管理
2. 工作线程
3. 任务接口
4. 阻塞队列

### Java线程池工作原理(过程)?
### newSingleThreadExcutor, newFixedThreadPool, newCachedThreadPool, newScheduledThreadPool, newSingleThreadScheduledExcutor区别?
- SingleThreadExcutor： 按顺序
- FixedThreadPool: 指定线程数
- CachedThreadPool: 由JVM决定
- ScheduledThreadPool: 定时以及周期任务


### 线程池的关闭有几种方式? 有哪些状态? 状态转移?
关闭线程池的方式：
- shutDown: 不接受新的线程，将任务队列中的线程处理完
- shutDownNow：将当前线程运行完，不处理队列中的线程
- tryTerminate：终止任务

shoutDwon, Stop, Running, Tiding, Terminated

### 说一说ThreadLocal使用, 原理?
`ThreadLocal obj = new ThreadLocal(() -> new Object());`
底层是通过ThreadLocalMap来实现，每个线程对应一个资源。

### ThreadLocal内存泄露? 如何解决?
内存泄露主要是因为ThreadLocalMap中主键使用的是弱引用，一旦失去最后一个强引用就会被回收，从而导致主键对应的值无法被获取从而导致内存泄露。
解决办法为：一旦决定某个资源不使用就调用remove()进行回收。

### 为什么ThreadLocal要使用弱引用?
实例对象被置为null之后, 实例可以被gc顺利回收

### synchronized锁的范围? 
- 对象方法
- 类方法
- 代码块：类.class, obj, this

### synchronized与Lock比较(锁与同步锁的比较)?
1. 底层实现
2. 性能
3. 功能
4. 显示与隐式
5. 中断其它阻塞线程

<21><129>
`t1.interrupt()`会中断其他阻塞线程中使用了 `lock.lockInterruptibly()` 指令的线程, 并使其抛出异常(InterruptedException) 
### synchronized与cas比较?
同步阻塞与非阻塞同步

### 说说 synchronized 关键字和 volatile 关键字的区别
<146>
1. s修饰方法和代码块, v修饰变量; s性能略差与v
2. s实现原子性和可见性, v实现可见性
3. v不发生阻塞, s发生阻塞
4. s解决多线程资源同步问题, v解决多线程下可见性

### 介绍一下AQS? 

### ReentrantLock如何实现可重入? 如何实现公平锁与非公平锁?
### 在监视器内部如何做到线程同步? 程序应该用哪种级别的同步? synchronized如何实现可重入(底层)? 
### 说说 JDK1.6 之后的synchronized 关键字底层做了哪些优化, 可以详细介绍一下这些优化吗
### 什么是自旋锁, 阻塞锁, 可重入锁, 乐观锁和悲观锁(使用场景, 各自实例), 轮询锁, 显示锁和内置锁, 读写锁, 对象锁和类锁, 锁粗化, 互斥锁, 消除锁, 轻量锁和偏向锁(这两个属于什么类型的锁)? 有几种锁状态?
<Java1: 21>
### volatile实现原理? 保证了什么? 能否保证原子性?
volatile实现两种功能:
1. 将当前缓存行数据刷回系统内存
2. 写回内存的操作会让其它CPU缓存无效

对使用volatile修饰变量进行读写操作，JVM会向处理器发送一条Lock前缀指令，这个前缀指令会将数据写回内存。而读取一个变量时不会从栈私有数据栈中获取变量值而是强制从公共堆中取得变量的值。

保证了可见性以及顺序性。不能保证原子性

### CAS机制? 包含哪些操作? 会产生哪些问题? 如何避免ABA问题?
机制：V(内存位置)A(预期值)B(新值)，仅当V符合预期值A时，处理器才会用B更新V的值，否则不会执行更新操作。
缺点：
- 只能对单个变量进行操作
- 循环等待时间长
- ABA问题。解决办法：时间戳

### 有哪些原子类?
- 基本类型
- 数组类型
- 对象引用类型

### 什么是原子操作? 什么是内存屏障?
原子操作：一系列不间断的操作
内存屏障：主内存与工作内存的操作

### 线程池设置大小与CPU的关系? 
最佳线程数目=(线程等待时间/线程CPU时间 + 1)* CPU数

### Thread中join()方法的原理? 
阻塞主线程，等待子线程结束后调用notify方法唤醒主线程

### Thread.wait()可以设置超时吗?
可以

### Java主线程如何捕获子线程抛出的异常? 
### 线程安全的实现方法?
<47>
- 互斥同步
- 非阻塞同步
- 无同步方案
- 不可变对象
### 如何判断线程是否终止? 如何正确终止处于运行状态的线程?
<Java2: 23>
1. 退出标志, 线程正常退出
2. 使用stop(直接释放资源, 导致不确定性), suspend(挂起资源不释放), resume
3. 使用interrupt方法

### isInterrupted和interrupted的区别?
interrupted清除状态, 第一次True, 第二次False
isInterrupted不清除状态

### 并行和并发的区别?
### 什么是协程?
<Java2: 14>
优点：无需内核上下文切换，减小开销；无需原子锁以及同步开销；单线程可以实现高并发
缺点：协程无法利用多核，处处都要使用非阻塞代码

### 一个类可以同时继承Thread和实现Runnable接口吗?
可以

### 如何让正在运行的线程暂停一段时间?
### sleep和yield的区别?
### sleep和wait的区别?
### 线程挂起怎么办?
### 导致死锁的原因? 怎么解除死锁?
死锁四个条件：
- 资源互斥：一个资源每次只能被一个线程使用
- 请求与保持：一个进程因请求而阻塞时，对已获得的资源保持不放
- 不剥夺条件：进程已获取的资源，在未使用完之前不剥夺
- 循环等待（闭环），若干个进程之间形成一种头尾相接的循环等待资源关系

解决：
- 撤销进程
- 回退
- 系统重启
- 加锁顺序
- 加锁时限
- 死锁检测

### 死锁, 饥饿, 活锁之间的定义区别?
### 当一个线程进入一个对象的一个synchronized方法后, 其他线程是否可以进入该对象的其他方法?
### 线程实现接口 VS 继承Thread
### FutureTask是什么?
### 说一下CylicBarrier与CountDownLatch的区别?
cylicBarrier阻塞一组线程直到达到一种状态
CountDownLatch阻塞主线程，等待子线程完成

### 什么是Semaphore? Exchanger?
Semaphore: 控制线程数，控制对同一资源访问的线程数量

### NIO, BIO, AIO区别? 谈谈Reactor模型
### 阻塞与非阻塞, 异步与同步区别?
### 加入有一个第三方接口, 有很多线程去调用获取数据, 现在规定每秒钟最多有10个线程同时调用它, 如何做到?
### 线程之间相互协调完成某个工作, 如何设计?
### 如何实现一个并发安全的链表?
### 如何保证N个线程可以访问N个资源, 同时又不会导致死锁?
### 高并发下如何做到安全地修改一行数据?
### 多个线程达到同一个状态再执行, 如何实现?
### 如何指定多个线程顺序?
### 如何控制线程在某个时间内完成, 不完成就撤销?
### 为什么使用读写锁而不使用synchronized这类锁?
### 实现多线程的方法?
### 实现Runnable接口和Callable接口的区别?
### 执行execute()方法和submit()方法的区别是什么呢?
### 如何创建线程池?
ThreadPoolExcutor构造和Excutors工具实现